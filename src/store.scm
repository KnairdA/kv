(use posix
     csv
     csv-string
     fmt
     format
     filepath)

(define-values (format-cell format-record format-csv) (make-format))

(define-record entry key value)
(define-record store name path content)

;; store and entry printing

(define-record-printer (entry x output)
  (fmt output (dsp (entry-key x))))

(define-record-printer (store x output)
  (if (null-list? (store-content x))
    (fmt output (dsp #f))
    (format output "窿篝矧瀛泔铘孱┅┅ㄤ彐轭篝矧弩攫蜷铘篝矧弩ㄦ矧磲ｆ窿磲篝矧瀛钺礤篝矧弩┅换孱趄泔铞弪箝镱ㄤ彐轭ㄩ蟓孱趄镦脲脲灬礅溽ㄥ铘蝙篝蜷铉娇脲ㄥ铘蝙脲孱趄┅┅ㄤ彐轭扉篝惧铘蝙鲠祯鲠祯濠篝蜷铉轭翦蝮疱蝮鲠祯┅ㄤ彐轭扉篝惧铘蝙蜥鳗ㄩㄡ钿扉篝蜥鳗戾铉翳蜥鳗┅磲脲孱趄ㄦ轵篝蜥鳗箦泔钿蜥鳗ｆ┅ㄤ彐轭ㄥ铘蝙掘邈矧孱趄扉篝俱篥蝈泔蜾扉篝ㄥ铘蝙脲孱趄ㄥ铘蝙鲠祯孱趄┅┅换篝矧泔铞弪箝镱犷箦蜷犰辁狒轱ㄤ彐轭疳翳倔麸蝈泔铘孱疳翳ㄩ铒ㄦ殪瀛屮轶趔疳翳┅扉篝磲扉篝惧铘蝙磲泱霏蝈泔蜾眷轶è泱霏疳蝮弪蝈徜犰疳翳┅┅┅ㄤ彐轭疳翳倔麸蝈疳翳！镳糸镱犰滹铒舡蝈徜磲脲篝矧ㄦ殪屦狒韬翎脲骈戾钺礤疳翳疳翳ㄩ滹铒舡蝈徜扉篝疳翳倔麸蝈泔铘孱疳翳┅┅ㄤ彐轭篝矧瀛俱篥篝矧濠ㄦ矧磲舡泱磲孱趄掘邈矧篝矧瀛泔铘孱篝矧濠┅ㄤ彐轭黩轸瀛篝矧篝矧濠ㄣ犰飙鏖翳秕麴豸骈戾篝矧瀛疳翳篝矧濠灬礅溽秕麴豸ㄦ眙秕麴豸ㄤ箴篝矧瀛俱篥篝矧濠┅┅换孱趄扉篝聃弪犷磲铋瘐灬糸镱ㄤ彐轭ㄦ轭洵孱趄孱趄殄脲ㄦ轭ㄩ蟓孱趄镦脲脲孱趄殄螬ㄤ彐轭蝈盹鲥孱趄孱趄殄脲蝈盹鲥ㄩ蟓孱趄镦脲脲孱趄殄螬ㄤ彐轭ㄡ痧孱洵躅轳蹂孱趄孱趄殄孱趄ㄡ痧孱蝈盹鲥孱趄孱趄殄ㄥ铘蝙脲孱趄┅扉篝孱趄┅换栝玷戾鲥轭翦蜴徙麸蝈徜汨犷珏犷泔眄轸磲铋瘐灬糸镱轭镱汜祆ㄤ彐轭蝈徜孱趄蝈趱蝾轭篝矧脲聃弪戾è孱趄ㄦ轭洵孱趄篝矧瀛泔铘孱篝矧濠脲┅ㄩㄥ铘蝙孱趄聃弪孱趄ｆ┅ㄤ彐轭躔溽翦篝矧瀛躞轭篝矧趄犷箧矧磲糸镱黩轸瀛篝矧磲脲篝矧篝矧瀛钺礤篝矧濠篝矧瀛疳翳篝矧濠趄犷箧矧磲糸镱篝矧瀛泔铘孱篝矧濠┅┅ㄤ彐轭黩轸瀛孱趄脲鲠祯濠灬礅溽ㄥ铘蜷弩ㄡ痧孱洵躅轳蹂孱趄孱趄殄磲脲孱趄脲扉篝惧铘蝙鲠祯鲠祯濠┅┅ㄤ彐轭ㄤ屐弭瀛孱趄脲灬礅溽ㄥ铘蜷弩蝈盹鲥孱趄孱趄殄脲┅ㄤ彐轭蝈钺礤孱趄镬洵脲铄鳝脲灬礅溽ㄥ铘蜷弩戾è镬洵孱趄ㄦ轭洵孱趄孱趄殄镬洵脲┅ㄩㄥ铘蝙镬洵孱趄ㄡ痧孱洵躅轳蹂孱趄蝈盹鲥孱趄孱趄殄镬洵脲磲脲孱趄铄鳝脲ㄥ铘蝙鲠祯镬洵孱趄┅孱趄殄螬┅