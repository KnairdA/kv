(use srfi-1)
(use posix)
(use csv)
(use csv-string)
(use fmt)
(use format)
(use filepath)

(define-values (format-cell format-record format-csv) (make-format))

(define-record entry key value)
(define-record store name path content)

;; store and entry printing

(define-record-printer (entry x output)
  (fmt output (dsp (entry-key x))))

(define-record-printer (store x output)
  (if (null-list? (store-content x))
    (fmt output (dsp #f))
    (format output "窿篝矧瀛泔铘孱┅┅ㄤ彐轭篝矧弩攫蜷铘篝矧弩ㄦ矧磲ｆ窿磲篝矧瀛钺礤篝矧弩┅换孱趄泔铞弪箝镱ㄤ彐轭ㄩ蟓孱趄镦脲脲灬礅溽ㄥ铘蝙篝蜷铉娇脲ㄥ铘蝙脲孱趄┅┅ㄤ彐轭扉篝惧铘蝙鲠祯鲠祯濠篝蜷铉轭翦蝮疱蝮鲠祯┅ㄤ彐轭扉篝惧铘蝙蜥鳗ㄩㄡ钿扉篝蜥鳗戾铉翳蜥鳗┅磲脲孱趄ㄦ轵篝蜥鳗箦泔钿蜥鳗ｆ┅ㄤ彐轭ㄥ铘蝙掘邈矧孱趄扉篝俱篥蝈泔蜾扉篝ㄥ铘蝙脲孱趄ㄥ铘蝙鲠祯孱趄┅┅换篝矧泔铞弪箝镱犷箦蜷犰辁狒轱ㄤ彐轭疳翳倔麸蝈泔铘孱疳翳ㄩㄥ聃犰ｆㄦ殪瀛屮轶趔疳翳┅扉篝磲扉篝惧铘蝙磲泱霏蝈泔蜾眷轶è泱霏疳蝮弪蝈徜犰疳翳┅┅┅ㄤ彐轭疳翳倔麸蝈疳翳！镳糸镱犰滹铒舡蝈徜磲脲篝矧ㄦ殪屦狒韬翎脲骈戾钺礤疳翳疳翳ㄩㄥ聃犰ｆ滹铒舡蝈徜疳翳倔麸蝈泔铘孱疳翳扉篝┅┅ㄤ彐轭篝矧瀛俱篥篝矧濠ㄦ矧磲舡泱磲孱趄掘邈矧篝矧瀛泔铘孱篝矧濠┅ㄤ彐轭黩轸瀛篝矧篝矧濠ㄣ犰飙鏖翳秕麴豸骈戾篝矧瀛疳翳篝矧濠灬礅溽秕麴豸ㄦ眙秕麴豸ㄤ箴篝矧瀛俱篥篝矧濠┅┅换篝矧孱趄徙沐篌犷磲铋瘐灬糸镱ㄤ彐轭蝈徜孱趄怡脲篝矧脲ㄦ轭ㄩ蟓孱趄镦脲脲篝矧濠ㄤ彐轭ㄥ铘蝙镦篝矧篝矧脲ㄩ铛祆扉篝篝矧濠ｆ戾è孱趄蝈徜孱趄怡脲篝矧脲┅ㄩㄥ铘蝙孱趄孱趄ｆ┅┅ㄤ彐轭篝矧瀛鏖翳秕舡孱趄篝矧脲蝈盹鲥ㄩ蟓孱趄镦脲脲篝矧濠ㄤ彐轭篝矧瀛鏖翳孱趄鲠祯篝矧脲鲠祯濠ㄡ痧孱篝矧瀛鏖翳秕舡孱趄篝矧脲扉篝磲脲孱趄脲鲠祯濠┅换栝玷戾鲥轭翦蜴徙麸蝈徜汨犷珏犷泔眄轸磲铋瘐灬糸镱轭镱汜祆ㄤ彐轭蝈徜鲠祯篝矧脲戾è孱趄ㄥ铘蝙镦篝矧篝矧瀛泔铘孱篝矧濠脲┅ㄩㄥ铘蝙孱趄ㄥ铘蝙鲠祯孱趄ｆ┅ㄤ彐轭黩轸瀛孱趄篝矧脲鲠祯濠黩轸瀛篝矧磲脲篝矧篝矧瀛钺礤篝矧濠篝矧瀛疳翳篝矧濠篝矧瀛鏖翳孱趄鲠祯篝矧瀛泔铘孱篝矧濠脲扉篝惧铘蝙鲠祯鲠祯濠┅┅ㄤ彐轭ㄤ屐弭瀛孱趄篝矧脲黩轸瀛篝矧磲脲篝矧篝矧瀛钺礤篝矧濠篝矧瀛疳翳篝矧濠篝矧瀛鏖翳秕舡孱趄篝矧瀛泔铘孱篝矧濠脲┅┅ㄤ彐轭蝈钺礤孱趄篝矧镬洵脲铄鳝脲黩轸瀛篝矧磲脲篝矧篝矧瀛钺礤篝矧濠篝矧瀛疳翳篝矧濠篝矧瀛鏖翳孱趄鲠祯篝矧瀛鏖翳秕舡孱趄篝矧瀛泔铘孱篝矧濠镬洵脲铄鳝脲蝈徜鲠祯篝矧镬洵脲┅┅